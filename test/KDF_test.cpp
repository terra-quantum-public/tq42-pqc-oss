#include <gtest/gtest.h>
#include <pqc/common.h>


TEST(KDF, TestVectors_1)
{
    std::vector<uint8_t> CheckM1M2 = {
        25,  74,  204, 205, 143, 75,  204, 7,   247, 233, 27,  231, 190, 52,  195, 178, 27,  65,  100, 3,   71,  223,
        52,  31,  120, 49,  46,  209, 189, 231, 102, 54,  96,  13,  75,  105, 33,  116, 199, 67,  45,  129, 254, 43,
        154, 29,  93,  46,  182, 233, 225, 67,  39,  175, 16,  244, 75,  143, 78,  118, 141, 221, 107, 116, 105, 61,
        55,  194, 68,  94,  124, 174, 112, 37,  168, 226, 18,  63,  246, 66,  173, 120, 46,  14,  135, 204, 133, 217,
        222, 74,  33,  192, 240, 102, 44,  16,  69,  217, 65,  235, 29,  232, 58,  9,   6,   235, 81,  223, 201, 21,
        155, 85,  174, 41,  97,  61,  64,  74,  28,  124, 209, 109, 114, 224, 195, 19,  147, 246, 197, 213, 25,  40,
        7,   46,  202, 7,   128, 140, 68,  246, 105, 214, 251, 50,  181, 119, 190, 188, 128, 141, 124, 5,   193, 70,
        155, 175, 32,  190, 164, 156, 104, 26,  155, 210, 82,  23,  202, 180, 170, 71,  150, 190, 110, 77,  84,  159,
        221, 131, 35,  71,  3,   177, 20,  40,  122, 128, 152, 153, 200, 156, 189, 88,  240, 209, 93,  53,  44,  45,
        160, 132, 251, 18,  247, 109, 67,  54,  233, 54,  21,  232, 201, 79,  37,  97,  119, 226, 159, 231, 251, 48,
        25,  170, 160, 23,  39,  206, 30,  188, 45,  4,   92,  119, 69,  57,  48,  227, 183, 66,  108, 42,  132, 193,
        209, 24,  167, 47,  111, 145, 211, 3,   200, 155, 178, 204, 110, 22};

    std::vector<uint8_t> M1 = {
        205, 101, 164, 229, 83,  64,  91,  80,  194, 243, 112, 1,   234, 129, 144, 95,  54,  214, 80,  204, 119, 95,
        218, 216, 152, 178, 227, 67,  100, 76,  179, 219, 37,  107, 192, 233, 179, 1,   247, 242, 26,  219, 170, 250,
        217, 121, 49,  191, 41,  11,  51,  214, 57,  22,  134, 186, 17,  63,  163, 254, 152, 167, 170, 245, 125, 216,
        158, 51,  74,  128, 19,  212, 117, 46,  101, 219, 156, 53,  12,  128, 52,  29,  51,  57,  57,  96,  79,  98,
        221, 237, 241, 250, 62,  201, 189, 236, 185, 4,   73,  2,   44,  138, 79,  111, 255, 199, 122, 220, 122, 164,
        35,  176, 114, 94,  42,  219, 172, 130, 171, 7,   41,  181, 146, 68,  16,  25,  36,  255, 73,  170, 245, 103,
        42,  5,   208, 16,  252, 164, 211, 196, 173, 180, 84,  216, 137, 16,  214, 178, 217, 254, 162, 133, 153, 55,
        74,  172, 161, 157, 139, 201, 100, 79,  128, 68,  170, 148, 8,   148, 190, 5,   146, 176, 115, 174, 213, 75,
        189, 108, 192, 166, 197, 155, 182, 190, 208, 29,  241, 143, 211, 232, 116, 230, 33,  161, 199, 22,  21,  51,
        242, 240, 175, 166, 238, 189, 193, 123, 186, 185, 177, 176, 110, 66,  10,  31,  114, 54,  84,  52,  196, 229,
        135, 213, 67,  250, 246, 94,  207, 135, 138, 174, 81,  93,  70,  202, 64,  16,  106, 123, 160, 135, 75,  135,
        221, 90,  74,  180, 220, 71,  32,  185, 136, 9,   205, 215, 86,  110, 102, 69,  192, 196, 171, 221, 61,  110,
        51,  201, 200, 200, 7,   188, 162, 29,  152, 62,  183, 35,  161, 85,  20,  158, 172, 70,  100, 113, 39,  192,
        107, 173, 3,   186, 160, 29,  70,  79,  13,  8,   168, 118, 53,  215, 63,  133, 191, 71,  181, 58,  131, 86,
        2,   229, 50,  78,  71,  174, 120, 167, 124, 69,  100, 203, 38,  4,   126, 120, 55,  190, 152, 121, 217, 204,
        185, 128, 68,  146, 196, 168, 62,  193, 194, 66,  61,  200, 179, 62,  13,  185, 117, 23,  91,  66,  106, 181,
        181, 210, 190, 102, 10,  211, 94,  190, 73,  27,  252, 81,  253, 150, 121, 51,  198, 176, 59,  148, 198, 209,
        64,  114, 10,  130, 97,  133, 240, 133, 99,  48,  148, 178, 88,  17,  144, 111, 220, 219, 213, 232, 24,  242,
        212, 109, 238, 252, 167, 250, 123, 114, 65,  253, 118, 160, 219, 168, 100, 0,   126, 162, 214, 208, 227, 130,
        43,  255, 247, 215, 230, 226, 148, 55,  204, 136, 59,  221, 121, 210, 19,  64,  200, 232, 214, 52,  104, 141,
        198, 222, 244, 239, 105, 236, 194, 127, 214, 206, 79,  39,  41,  242, 96,  74,  210, 81,  118, 54,  93,  130,
        80,  184, 83,  37,  212, 55,  4,   10,  233, 196, 253, 51,  34,  158, 65,  10,  162, 7,   239, 147, 115, 43,
        253, 35,  106, 183, 160, 83,  104, 63,  120, 78,  242, 0,   72,  91,  22,  48};

    std::vector<uint8_t> M2 = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10};

    std::vector<uint8_t> key(CheckM1M2.size());
    CIPHER_HANDLE kdf = PQC_kdf(M1.data(), M1.size(), M2.data(), M2.size(), key.data(), key.size());
    EXPECT_EQ(kdf, PQC_OK); // Because compiler see kdf as non usefull varrible
    EXPECT_EQ(key, CheckM1M2);
}
TEST(KDF, TestVectors_2)
{
    std::vector<uint8_t> CheckM2M1 = {
        176, 73,  65,  49,  66,  143, 177, 186, 42,  51,  27,  39,  14,  64,  85,  75,  8,   122, 6,   128, 190, 149,
        11,  112, 97,  213, 252, 206, 120, 141, 169, 124, 25,  196, 172, 58,  3,   146, 179, 239, 198, 91,  148, 113,
        193, 141, 21,  213, 32,  146, 20,  244, 43,  247, 191, 70,  208, 251, 144, 117, 130, 6,   252, 55,  62,  173,
        187, 14,  235, 208, 133, 172, 176, 60,  74,  162, 15,  217, 153, 236, 30,  4,   0,   209, 241, 93,  204, 49,
        249, 149, 231, 82,  70,  218, 240, 162, 49,  67,  105, 227, 165, 140, 117, 5,   198, 108, 203, 94,  233, 37,
        125, 217, 209, 137, 16,  156, 213, 71,  214, 140, 22,  34,  212, 137, 75,  2,   193, 64,  240, 59,  69,  140,
        110, 199, 93,  244, 8,   205, 59,  174, 39,  114, 200, 3,   247, 114, 51,  96,  182, 145, 250, 175, 90,  11,
        159, 149, 211, 201, 66,  119, 110, 41,  207, 207, 56,  135, 54,  203, 56,  127, 71,  183, 135, 106, 200, 96,
        191, 129, 17,  112, 42,  48,  203, 55,  221, 152, 164, 97,  89,  40,  122, 221, 214, 255, 50,  72,  122, 125,
        52,  36,  145, 211, 42,  155, 197, 151, 37,  121, 195, 50,  4,   85,  97,  138, 78,  120, 167, 88,  43,  141,
        227, 157, 237, 216, 229, 125, 179, 113, 13,  111, 245, 46,  98,  145, 28,  243, 164, 18,  184, 134, 59,  41,
        231, 29,  142, 237, 18,  160, 59,  76,  0,   89,  143, 32,  250, 36};

    std::vector<uint8_t> M2 = {
        205, 101, 164, 229, 83,  64,  91,  80,  194, 243, 112, 1,   234, 129, 144, 95,  54,  214, 80,  204, 119, 95,
        218, 216, 152, 178, 227, 67,  100, 76,  179, 219, 37,  107, 192, 233, 179, 1,   247, 242, 26,  219, 170, 250,
        217, 121, 49,  191, 41,  11,  51,  214, 57,  22,  134, 186, 17,  63,  163, 254, 152, 167, 170, 245, 125, 216,
        158, 51,  74,  128, 19,  212, 117, 46,  101, 219, 156, 53,  12,  128, 52,  29,  51,  57,  57,  96,  79,  98,
        221, 237, 241, 250, 62,  201, 189, 236, 185, 4,   73,  2,   44,  138, 79,  111, 255, 199, 122, 220, 122, 164,
        35,  176, 114, 94,  42,  219, 172, 130, 171, 7,   41,  181, 146, 68,  16,  25,  36,  255, 73,  170, 245, 103,
        42,  5,   208, 16,  252, 164, 211, 196, 173, 180, 84,  216, 137, 16,  214, 178, 217, 254, 162, 133, 153, 55,
        74,  172, 161, 157, 139, 201, 100, 79,  128, 68,  170, 148, 8,   148, 190, 5,   146, 176, 115, 174, 213, 75,
        189, 108, 192, 166, 197, 155, 182, 190, 208, 29,  241, 143, 211, 232, 116, 230, 33,  161, 199, 22,  21,  51,
        242, 240, 175, 166, 238, 189, 193, 123, 186, 185, 177, 176, 110, 66,  10,  31,  114, 54,  84,  52,  196, 229,
        135, 213, 67,  250, 246, 94,  207, 135, 138, 174, 81,  93,  70,  202, 64,  16,  106, 123, 160, 135, 75,  135,
        221, 90,  74,  180, 220, 71,  32,  185, 136, 9,   205, 215, 86,  110, 102, 69,  192, 196, 171, 221, 61,  110,
        51,  201, 200, 200, 7,   188, 162, 29,  152, 62,  183, 35,  161, 85,  20,  158, 172, 70,  100, 113, 39,  192,
        107, 173, 3,   186, 160, 29,  70,  79,  13,  8,   168, 118, 53,  215, 63,  133, 191, 71,  181, 58,  131, 86,
        2,   229, 50,  78,  71,  174, 120, 167, 124, 69,  100, 203, 38,  4,   126, 120, 55,  190, 152, 121, 217, 204,
        185, 128, 68,  146, 196, 168, 62,  193, 194, 66,  61,  200, 179, 62,  13,  185, 117, 23,  91,  66,  106, 181,
        181, 210, 190, 102, 10,  211, 94,  190, 73,  27,  252, 81,  253, 150, 121, 51,  198, 176, 59,  148, 198, 209,
        64,  114, 10,  130, 97,  133, 240, 133, 99,  48,  148, 178, 88,  17,  144, 111, 220, 219, 213, 232, 24,  242,
        212, 109, 238, 252, 167, 250, 123, 114, 65,  253, 118, 160, 219, 168, 100, 0,   126, 162, 214, 208, 227, 130,
        43,  255, 247, 215, 230, 226, 148, 55,  204, 136, 59,  221, 121, 210, 19,  64,  200, 232, 214, 52,  104, 141,
        198, 222, 244, 239, 105, 236, 194, 127, 214, 206, 79,  39,  41,  242, 96,  74,  210, 81,  118, 54,  93,  130,
        80,  184, 83,  37,  212, 55,  4,   10,  233, 196, 253, 51,  34,  158, 65,  10,  162, 7,   239, 147, 115, 43,
        253, 35,  106, 183, 160, 83,  104, 63,  120, 78,  242, 0,   72,  91,  22,  48};

    std::vector<uint8_t> M1 = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10};

    std::vector<uint8_t> key(CheckM2M1.size());
    CIPHER_HANDLE kdf = PQC_kdf(M1.data(), M1.size(), M2.data(), M2.size(), key.data(), key.size());
    EXPECT_EQ(kdf, PQC_OK); // Because compiler see kdf as non usefull varrible
    EXPECT_EQ(key, CheckM2M1);
}

TEST(KDF, TestVectors_3)
{
    std::vector<uint8_t> CheckM1M3 = {
        112, 252, 179, 158, 21,  66,  153, 193, 11,  203, 246, 5,   161, 224, 88,  110, 122, 193, 255, 15,  185, 169,
        26,  24,  199, 68,  5,   184, 2,   7,   108, 19,  5,   170, 218, 38,  49,  112, 163, 87,  255, 143, 196, 112,
        27,  111, 207, 14,  10,  30,  81,  112, 194, 62,  158, 5,   231, 22,  14,  203, 195, 127, 118, 223, 221, 105,
        177, 87,  33,  67,  195, 59,  102, 159, 95,  65,  136, 142, 247, 75,  213, 174, 137, 81,  145, 196, 140, 33,
        94,  186, 114, 137, 196, 121, 65,  19,  105, 103, 105, 160, 185, 174, 106, 215, 73,  62,  35,  2,   145, 108,
        187, 96,  29,  245, 6,   195, 22,  196, 210, 187, 101, 73,  43,  3,   226, 25,  34,  133, 204, 226, 117, 153,
        37,  152, 45,  210, 202, 243, 233, 37,  205, 184, 177, 97,  231, 203, 216, 91,  10,  28,  65,  249, 54,  9,
        75,  219, 69,  244, 241, 169, 235, 200, 123, 167, 99,  39,  155, 189, 132, 69,  52,  250, 17,  203, 0,   77,
        253, 235, 171, 252, 236, 5,   12,  122, 60,  53,  251, 193, 2,   124, 168, 199, 60,  75,  56,  63,  255, 149,
        49,  25,  236, 214, 90,  57,  92,  42,  143, 70,  231, 56,  23,  126, 219, 230, 178, 47,  2,   83,  210, 133,
        20,  192, 86,  150, 189, 156, 97,  87,  121, 46,  69,  112, 112, 142, 103, 190, 212, 11,  212, 145, 82,  153,
        193, 46,  135, 194, 85,  167, 186, 2,   71,  67,  227, 103, 115, 209};

    std::vector<uint8_t> M3 = {
        205, 101, 164, 229, 83,  64,  91,  80,  194, 243, 112, 1,   234, 129, 144, 95,  54,  214, 80,  204, 119, 95,
        218, 216, 152, 178, 227, 67,  100, 76,  179, 219, 37,  107, 192, 233, 179, 1,   247, 242, 26,  219, 170, 250,
        217, 121, 49,  191, 41,  11,  51,  214, 57,  22,  134, 186, 17,  63,  163, 254, 152, 167, 170, 245, 125, 216,
        158, 51,  74,  128, 19,  85,  20,  158, 172, 70,  100, 113, 39,  192, 107, 173, 3,   186, 160, 29,  70,  79,
        13,  8,   168, 118, 53,  215, 63,  133, 191, 71,  181, 58,  131, 86,  2,   229, 50,  78,  71,  174, 120, 167,
        124, 69,  100, 203, 38,  4,   126, 120, 55,  190, 152, 121, 217, 204, 185, 128, 68,  146, 196, 168, 62,  193,
        194, 66,  61,  200, 179, 62,  13,  185, 117, 23,  91,  66,  106, 181, 181, 210, 190, 102, 10,  211, 94,  190,
        73,  27,  252, 81,  253, 150, 121, 51,  198, 176, 59,  148, 198, 209, 64,  114, 10,  130, 97,  133, 240, 133,
        99,  48,  148, 178, 88,  17,  144, 111, 220, 219, 213, 232, 24,  242, 212, 109, 238, 252, 167, 250, 123, 114,
        65,  253, 118, 160, 219, 168, 100, 0,   126, 162, 214, 208, 227, 130, 43,  255, 247, 215, 230, 226, 148, 55,
        204, 136, 59,  221, 121, 210, 19,  64,  200, 232, 214, 52,  104, 141, 198, 222, 244, 239, 105, 236, 194, 127,
        214, 206, 79,  39,  41,  242, 96,  74,  210, 81,  118, 54,  93,  130, 80,  184, 83,  37,  212, 55,  4,   10,
        233, 196, 253, 51,  34,  158, 65,  10,  162, 7,   239, 147, 115, 43,  253, 35,  106, 183, 160, 83,  104, 63,
        201, 200, 200, 7,   188, 162, 29,  152, 62,  183, 35,  161, 110, 51,  120, 78,  242, 0,   72,  91,  22,  48,
        212, 117, 46,  101, 219, 156, 53,  12,  128, 52,  29,  51,  57,  57,  96,  79,  98,  221, 237, 241, 250, 62,
        201, 189, 236, 185, 4,   73,  2,   44,  138, 79,  111, 255, 199, 122, 220, 122, 164, 35,  176, 114, 94,  42,
        219, 172, 130, 171, 7,   41,  181, 146, 68,  16,  25,  36,  255, 73,  170, 245, 103, 42,  5,   208, 16,  252,
        164, 211, 196, 173, 180, 84,  216, 137, 16,  214, 178, 217, 254, 162, 133, 153, 55,  74,  172, 161, 157, 139,
        201, 100, 79,  128, 68,  170, 148, 8,   148, 190, 5,   146, 176, 115, 174, 213, 75,  189, 108, 192, 166, 197,
        155, 182, 190, 208, 29,  241, 143, 211, 232, 116, 230, 33,  161, 199, 22,  21,  51,  242, 240, 175, 166, 238,
        189, 193, 123, 186, 185, 177, 176, 110, 66,  10,  31,  114, 54,  84,  52,  196, 229, 135, 213, 67,  250, 246,
        94,  207, 135, 138, 174, 81,  93,  70,  202, 64,  16,  106, 123, 160, 135, 75,  135, 221, 90,  74,  180, 220,
        71,  32,  185, 136, 9,   205, 215, 86,  110, 102, 69,  192, 196, 171, 221, 61};

    std::vector<uint8_t> M1 = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10};

    std::vector<uint8_t> key(CheckM1M3.size());
    CIPHER_HANDLE kdf = PQC_kdf(M1.data(), M1.size(), M3.data(), M3.size(), key.data(), key.size());
    EXPECT_EQ(kdf, PQC_OK); // Because compiler see kdf as non usefull varrible
    EXPECT_EQ(key, CheckM1M3);
}


TEST(KDF, TestVectors_4)
{
    std::vector<uint8_t> CheckM4M3 = {
        26,  198, 110, 161, 6,   5,   113, 49,  43,  247, 241, 97,  164, 61,  117, 249, 166, 58,  65,  232, 78,  117,
        33,  229, 132, 185, 140, 120, 220, 86,  255, 52,  217, 83,  39,  243, 157, 199, 86,  142, 0,   152, 247, 217,
        200, 80,  36,  191, 35,  144, 47,  144, 204, 46,  184, 171, 57,  86,  205, 42,  247, 76,  58,  0,   148, 198,
        120, 224, 72,  80,  70,  118, 53,  5,   89,  58,  96,  237, 214, 217, 0,   67,  133, 172, 220, 119, 205, 184,
        72,  208, 64,  233, 179, 84,  238, 67,  68,  61,  137, 227, 230, 176, 142, 3,   28,  207, 114, 177, 146, 235,
        127, 109, 254, 166, 128, 128, 223, 72,  237, 120, 102, 225, 208, 200, 247, 35,  80,  31,  52,  99,  185, 243,
        72,  34,  212, 59,  115, 160, 202, 142, 84,  51,  166, 35,  146, 238, 182, 188, 180, 2,   7,   125, 106, 77,
        172, 5,   50,  143, 33,  219, 73,  126, 121, 209, 226, 170, 122, 197, 78,  60,  242, 142, 83,  247, 83,  176,
        146, 138, 140, 96,  248, 247, 64,  97,  201, 132, 42,  22,  60,  169, 251, 133, 193, 16,  156, 170, 94,  39,
        201, 170, 251, 154, 5,   129, 34,  57,  211, 84,  217, 221, 12,  193, 94,  190, 221, 126, 25,  68,  153, 124,
        209, 24,  46,  63,  164, 53,  127, 236, 219, 87,  126, 74,  128, 90,  221, 196, 76,  190, 37,  134, 149, 61,
        194, 129, 93,  36,  146, 33,  174, 87,  36,  223, 243, 223, 191, 49,  235, 204, 246, 147, 109, 180, 100, 65,
        171, 143, 85,  35,  206, 18,  139, 244, 139, 181, 73,  167, 151, 45,  17,  97,  236, 218, 7,   86,  216, 78,
        171, 102, 0,   69,  100, 150, 253, 131, 210, 65,  95,  17,  233, 45,  30,  132, 33,  159, 193, 102, 242, 149,
        254, 136, 248, 2,   144, 112, 238, 89,  248, 250, 241, 144, 50,  10,  117, 97,  228, 22,  98,  242, 186, 201,
        218, 186, 26,  170, 253, 177, 75,  127, 26,  47,  36,  72,  209, 224, 204, 4,   79,  254, 121, 171, 59,  226,
        218, 196, 171, 66,  227, 92,  122, 207, 104, 96,  124, 232, 30,  42,  123, 87,  43,  63,  192, 130, 175, 121,
        210, 23,  23,  225, 55,  127, 169, 69,  107, 144, 249, 224, 138, 133, 247, 53,  161, 102, 159, 15,  116, 99,
        186, 85,  83,  220, 124, 132, 142, 147, 182, 99,  42,  76,  34,  59,  37,  146, 142, 61,  34,  17,  183, 227,
        27,  161, 163, 124, 145, 60,  14,  217, 32,  13,  35,  170, 235, 57,  18,  221, 55,  89,  200, 239, 14,  247,
        56,  237, 173, 185, 91,  94,  38,  75,  191, 185, 72,  210, 200, 210, 175, 7,   56,  201, 52,  186, 240, 31,
        54,  205, 80,  222, 46,  154, 12,  144, 73,  79,  141, 231, 16,  19,  199, 37,  62,  149, 119, 74,  127, 233,
        61,  229, 206, 76,  244, 186, 28,  14,  72,  246, 70,  123, 116, 60,  231, 118, 90,  44,  85,  183, 44,  115,
        224, 177, 147, 134, 212, 31,  200, 183, 71,  197, 237, 203, 161, 189, 86,  118, 22,  214, 156, 243, 160, 192,
        90,  135, 75,  200, 203, 86,  125, 42,  142, 142, 10,  192, 143, 117, 8,   36,  134, 247, 143, 69,  49,  68,
        41,  102, 217, 21,  25,  224, 98,  234, 44,  158, 151, 1,   54,  139, 121, 37,  253, 165, 37,  210, 3,   100,
        158, 33,  179, 44,  61,  182, 35,  109, 218, 240, 180, 54,  105, 84,  128, 28,  136, 198, 166, 168, 163, 166,
        194, 61,  216, 87,  58,  145, 3,   198, 121, 105, 251, 233, 56,  115, 79,  211, 185, 192, 147, 212, 240, 110,
        180, 69,  83,  17,  209, 205, 198, 133, 243, 222, 244, 112, 96,  60,  104, 182, 90,  207, 50,  15,  251, 15,
        181, 138, 144, 250, 156, 253, 154, 246, 222, 17,  212, 0,   52,  228, 17,  85,  34,  75,  140, 181, 56,  223,
        226, 151, 170, 15,  30,  153, 7,   112, 215, 19,  51,  152, 122, 211, 239, 40,  243, 145, 28,  197, 227, 191,
        98,  84,  99,  123, 102, 145, 194, 69,  219, 114, 254, 39,  199, 191, 184, 249, 20,  203, 91,  84,  59,  0,
        215, 67,  71,  160, 157, 126, 78,  25,  174, 131, 103, 68,  47,  87,  245, 145, 80,  171, 95,  226, 8,   37,
        92,  61,  133, 109, 212, 84,  139, 50,  118, 123, 143, 50,  241, 173, 100, 217, 172, 10,  226, 56,  55,  164,
        250, 125, 85,  158, 27,  100, 245, 220, 195, 95,  9,   191, 205, 253, 92,  11,  88,  47,  56,  11,  157, 106,
        230, 126, 39,  90,  59,  169, 15,  76,  162, 120, 57,  85,  207, 122, 44,  254, 12,  160, 40,  192, 126, 173,
        187, 99,  100, 164, 230, 182, 97,  52,  124, 184, 131, 96,  202, 26,  80,  74,  177, 4,   4,   216, 198, 222,
        174, 227, 130, 102, 66,  61,  87,  33,  110, 218, 90,  239, 108, 158, 125, 223, 116, 29,  38,  180, 80,  2,
        77,  9,   188, 240, 3,   125, 48,  55,  27,  29,  221, 11,  250, 90,  186, 32,  25,  42,  251, 175, 115, 4,
        130, 123, 7,   26,  19,  53,  82,  12,  235, 4,   214, 99,  128, 36,  221, 193, 4,   175, 79,  11,  66,  109,
        15,  92,  49,  23,  47,  191, 41,  109, 254, 218, 72,  195, 18,  72,  46,  181, 112, 237, 136, 218, 71,  145,
        253, 122, 128, 127, 103, 14,  55,  27,  34,  11,  243, 43,  102, 237, 249, 6,   161, 45,  119, 30,  119, 73,
        75,  23,  58,  63,  158, 171, 245, 76,  29,  100, 78,  120, 215, 218, 251, 56,  0,   8,   50,  66,  32,  130,
        18,  229, 230, 72,  17,  214, 198, 142, 168, 217, 29,  131, 101, 153, 39,  139, 74,  126, 1,   117, 44,  198,
        125, 7,   238, 251, 102, 64,  223, 102, 218, 250, 51,  155, 213, 100, 8,   122, 52,  239, 191, 70,  250, 214,
        64,  197, 125, 25,  49,  183, 193, 119, 47,  170, 200, 247, 197, 209, 61,  207, 131, 73,  49,  42,  181, 176,
        74,  39,  17,  245, 102, 47,  221, 236, 100, 224, 54,  69,  65,  248, 172, 116, 151, 23,  79,  3,   119, 6,
        83,  50,  71,  171, 44,  223, 144, 111, 109, 123, 229, 248, 243, 58,  83,  226, 168, 69,  80,  18,  209, 90,
        19,  30,  234, 237, 231, 69,  112, 91,  6,   221, 34,  123, 90,  43,  201, 116, 70,  67,  255, 113, 235, 37,
        223, 2,   118, 241, 144, 171, 6,   251, 188, 59,  244, 136, 230, 1,   46,  48,  144, 57,  68,  17,  91,  130,
        188, 231, 206, 178, 3,   104, 223, 109, 42,  108, 118, 237, 118, 201, 206, 217, 35,  185, 197, 30,  82,  70,
        54,  170, 0,   233, 169, 63,  106, 70,  72,  229, 100, 13,  197, 122, 218, 248, 90,  111, 123, 182, 73,  232,
        50,  22,  83,  95,  182, 21,  100, 66,  98,  239, 7,   115, 119, 116, 106, 34,  232, 68,  195, 144, 133, 166,
        11,  234, 113, 48,  191, 120, 201, 81,  71,  30,  138, 175, 234, 32,  99,  229, 92,  245, 15,  41,  123, 140,
        112, 216, 231, 68,  119, 177, 38,  159, 249, 194, 100, 237, 138, 103, 19,  35,  110, 128, 190, 95,  32,  117,
        153, 157, 203, 236, 67,  249, 148, 68,  77,  105, 112, 19,  133, 7,   154, 158, 37,  4,   66,  99,  40,  131,
        215, 168, 220, 75,  96,  69,  118, 95,  65,  190, 146, 189, 160, 210, 63,  245, 44,  235, 100, 106, 48,  249,
        197, 129, 92,  15,  52,  187, 126, 129, 26,  207, 2,   112, 94,  131, 236, 218, 198, 163, 93,  164, 53,  39,
        27,  207, 246, 205, 252, 183, 94,  197, 38,  84,  148, 192, 209, 164, 146, 37,  129, 38,  150, 196, 123, 207,
        43,  178, 135, 20,  27,  63,  190, 5,   142, 19,  120, 78,  211, 202, 93,  168, 144, 47,  171, 83,  20,  35,
        255, 212, 13,  229, 64,  58,  13,  183, 242, 78,  161, 12,  156, 220, 62,  145, 0,   51,  13,  250, 26,  36,
        9,   99,  140, 52,  230, 195, 120, 248, 149, 80,  196, 89,  57,  67,  27,  35,  91,  123, 90,  117, 199, 110,
        160, 157, 83,  201, 111, 81,  154, 239, 120, 132, 103, 53,  195, 225, 228, 18,  198, 162, 194, 14,  106, 186,
        175, 79,  254, 84,  135, 17,  234, 158, 92,  96,  132, 218, 29,  216, 60,  2,   182, 160, 222, 45,  49,  244,
        91,  213, 39,  222, 116, 136, 86,  193, 205, 84,  14,  161, 231, 137, 248, 34,  91,  52,  187, 147, 222, 93,
        197, 9,   114, 157, 203, 201, 238, 50,  90,  11,  232, 29,  125, 105, 168, 161, 74,  79,  5,   201, 167, 125,
        90,  241, 216, 133, 192, 11,  182, 8,   101, 255, 17,  99,  13,  190, 32,  80,  89,  241, 75,  225, 209, 225,
        122, 168, 149, 184, 217, 231, 102, 56,  200, 129, 151, 56,  202, 89,  46,  148, 189, 193, 185, 106, 198, 206,
        117, 52,  169, 182, 17,  136, 158, 25,  207, 252, 227, 186, 84,  97,  243, 58,  232, 216, 86,  15,  27,  17,
        179, 38,  120, 22,  246, 44,  86,  73,  89,  73,  207, 86,  227, 178, 87,  248, 82,  111, 51,  140, 162, 113};

    std::vector<uint8_t> M3 = {
        205, 101, 164, 229, 83,  64,  91,  80,  194, 243, 112, 1,   234, 129, 144, 95,  54,  214, 80,  204, 119, 95,
        218, 216, 152, 178, 227, 67,  100, 76,  179, 219, 37,  107, 192, 233, 179, 1,   247, 242, 26,  219, 170, 250,
        217, 121, 49,  191, 41,  11,  51,  214, 57,  22,  134, 186, 17,  63,  163, 254, 152, 167, 170, 245, 125, 216,
        158, 51,  74,  128, 19,  85,  20,  158, 172, 70,  100, 113, 39,  192, 107, 173, 3,   186, 160, 29,  70,  79,
        13,  8,   168, 118, 53,  215, 63,  133, 191, 71,  181, 58,  131, 86,  2,   229, 50,  78,  71,  174, 120, 167,
        124, 69,  100, 203, 38,  4,   126, 120, 55,  190, 152, 121, 217, 204, 185, 128, 68,  146, 196, 168, 62,  193,
        194, 66,  61,  200, 179, 62,  13,  185, 117, 23,  91,  66,  106, 181, 181, 210, 190, 102, 10,  211, 94,  190,
        73,  27,  252, 81,  253, 150, 121, 51,  198, 176, 59,  148, 198, 209, 64,  114, 10,  130, 97,  133, 240, 133,
        99,  48,  148, 178, 88,  17,  144, 111, 220, 219, 213, 232, 24,  242, 212, 109, 238, 252, 167, 250, 123, 114,
        65,  253, 118, 160, 219, 168, 100, 0,   126, 162, 214, 208, 227, 130, 43,  255, 247, 215, 230, 226, 148, 55,
        204, 136, 59,  221, 121, 210, 19,  64,  200, 232, 214, 52,  104, 141, 198, 222, 244, 239, 105, 236, 194, 127,
        214, 206, 79,  39,  41,  242, 96,  74,  210, 81,  118, 54,  93,  130, 80,  184, 83,  37,  212, 55,  4,   10,
        233, 196, 253, 51,  34,  158, 65,  10,  162, 7,   239, 147, 115, 43,  253, 35,  106, 183, 160, 83,  104, 63,
        201, 200, 200, 7,   188, 162, 29,  152, 62,  183, 35,  161, 110, 51,  120, 78,  242, 0,   72,  91,  22,  48,
        212, 117, 46,  101, 219, 156, 53,  12,  128, 52,  29,  51,  57,  57,  96,  79,  98,  221, 237, 241, 250, 62,
        201, 189, 236, 185, 4,   73,  2,   44,  138, 79,  111, 255, 199, 122, 220, 122, 164, 35,  176, 114, 94,  42,
        219, 172, 130, 171, 7,   41,  181, 146, 68,  16,  25,  36,  255, 73,  170, 245, 103, 42,  5,   208, 16,  252,
        164, 211, 196, 173, 180, 84,  216, 137, 16,  214, 178, 217, 254, 162, 133, 153, 55,  74,  172, 161, 157, 139,
        201, 100, 79,  128, 68,  170, 148, 8,   148, 190, 5,   146, 176, 115, 174, 213, 75,  189, 108, 192, 166, 197,
        155, 182, 190, 208, 29,  241, 143, 211, 232, 116, 230, 33,  161, 199, 22,  21,  51,  242, 240, 175, 166, 238,
        189, 193, 123, 186, 185, 177, 176, 110, 66,  10,  31,  114, 54,  84,  52,  196, 229, 135, 213, 67,  250, 246,
        94,  207, 135, 138, 174, 81,  93,  70,  202, 64,  16,  106, 123, 160, 135, 75,  135, 221, 90,  74,  180, 220,
        71,  32,  185, 136, 9,   205, 215, 86,  110, 102, 69,  192, 196, 171, 221, 61};

    std::vector<uint8_t> M4 = {
        0,   1,   2,   3,   4,   5,   6,   7,   8,   9,   10,  112, 194, 62,  158, 5,   231, 14,  203, 195, 127, 118,
        223, 221, 105, 177, 87,  33,  67,  195, 59,  102, 159, 95,  65,  136, 142, 247, 75,  213, 174, 137, 81,  145,
        196, 140, 33,  94,  186, 114, 137, 196, 121, 65,  19,  105, 103, 105, 160, 185, 174, 106, 215, 73,  62,  35,
        2,   145, 108, 187, 96,  29,  245, 6,   195, 22,  196, 210, 187, 101, 73,  43,  3,   226, 25,  34,  133, 204,
        226, 117, 153, 37,  152, 45,  210, 202, 243, 233, 37,  205, 184, 177, 97,  231, 203, 216, 91,  10,  28,  65,
        249, 54,  9,   75,  219, 69,  244, 241, 169, 235, 200, 123, 167, 99,  39,  155, 189, 132, 69,  52,  250, 17,
        203, 0,   77,  253, 235, 171, 252, 236, 5,   12,  122, 60,  53,  251, 193, 2,   124, 168, 199, 60,  75};

    std::vector<uint8_t> key(CheckM4M3.size());
    CIPHER_HANDLE kdf = PQC_kdf(M4.data(), M4.size(), M3.data(), M3.size(), key.data(), key.size());
    EXPECT_EQ(kdf, PQC_OK); // Because compiler see kdf as non usefull varrible
    EXPECT_EQ(key, CheckM4M3);
}

TEST(KDF, TestVectors_5)
{
    std::vector<uint8_t> CheckM5M6 = {106, 252, 79};

    std::vector<uint8_t> M5 = {0, 4, 2};

    std::vector<uint8_t> M6 = {111, 0, 0};

    std::vector<uint8_t> key(CheckM5M6.size());
    CIPHER_HANDLE kdf = PQC_kdf(M5.data(), M5.size(), M6.data(), M6.size(), key.data(), key.size());
    EXPECT_EQ(kdf, PQC_OK); // Because compiler see kdf as non usefull varrible
    EXPECT_EQ(key, CheckM5M6);
}


TEST(KDF, TestVectors_6)
{
    std::vector<uint8_t> CheckM7M7 = {145, 142, 215};
    std::vector<uint8_t> M7 = {0, 0, 0};
    std::vector<uint8_t> M7_ = {0, 0, 0};

    std::vector<uint8_t> key(CheckM7M7.size());
    // memset(key.data(), 0, key.size());
    CIPHER_HANDLE kdf = PQC_kdf(M7.data(), M7.size(), M7_.data(), M7_.size(), key.data(), key.size());

    EXPECT_EQ(kdf, PQC_OK); // Because compiler see kdf as non usefull varrible
    EXPECT_EQ(key, CheckM7M7);
}
